<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Редагування профілю</title>
    <link rel="stylesheet" href="https://unpkg.com/normalize.css">

    <style>
        @import url('https://unpkg.com/normalize.css') layer(normalize);
        @layer normalize, base, demo;

        @layer base {
            :root {
                --accent: hsl(200 80% 50%);
                --background-light: #f0f0f3;
                --background-dark: #0b0b0f;
                --card-bg-light: rgba(255,255,255,0.25);
                --card-bg-dark: rgba(0,0,0,0.25);
                --input-bg-light: rgba(255,255,255,0.15);
                --input-bg-dark: rgba(0,0,0,0.2);
            }

            html[data-theme="light"] {
                --background: var(--background-light);
                --card-bg: var(--card-bg-light);
                --input-bg: var(--input-bg-light);
                --text-color: #000;
            }

            html[data-theme="dark"] {
                --background: var(--background-dark);
                --card-bg: var(--card-bg-dark);
                --input-bg: var(--input-bg-dark);
                --text-color: #fff;
            }

            body {
                margin: 0;
                font-family: 'SF Pro Text', Arial, sans-serif;
                display: grid;
                place-items: center;
                min-height: 100vh;
                background: var(--background);
                transition: background 0.3s;
            }

            body::before {
                content: '';
                position: fixed;
                top:0; left:0;
                width: 100vw; height: 100vh;
                --size: 45px;
                --line: rgba(255,255,255,0.1);
                background: linear-gradient(90deg, var(--line) 1px, transparent 1px var(--size))
                calc(var(--size)*0.36) 50% / var(--size) var(--size),
                linear-gradient(var(--line) 1px, transparent 1px var(--size))
                0% calc(var(--size)*0.32) / var(--size) var(--size);
                pointer-events: none;
                z-index: -1;
            }
        }

        @layer demo {
            .profile-card {
                max-width: 500px;
                width: 100%;
                background: var(--card-bg);
                backdrop-filter: blur(15px) saturate(180%);
                border-radius: 20px;
                border: 1px solid rgba(255,255,255,0.2);
                padding: 30px;
                box-shadow: 0 8px 32px rgba(0,0,0,0.2);
                color: var(--text-color);
                transition: all 0.3s;
            }

            .profile-photo {
                display: block;
                margin: 0 auto 20px;
                border-radius: 50%;
                width: 120px;
                height: 120px;
                object-fit: cover;
                border: 3px solid var(--accent);
            }

            .form-group {
                margin-bottom: 15px;
            }

            label {
                display: block;
                font-weight: 600;
                margin-bottom: 5px;
            }

            input, select {
                width: 100%;
                padding: 12px;
                border-radius: 12px;
                border: none;
                background: var(--input-bg);
                color: var(--text-color);
                font-size: 1rem;
                transition: 0.3s;
            }

            input:focus, select:focus {
                outline: 2px solid var(--accent);
                background: rgba(255,255,255,0.25);
            }

            button {
                width: 100%;
                padding: 14px;
                border-radius: 12px;
                border: none;
                background: var(--accent);
                color: white;
                font-weight: 600;
                cursor: pointer;
                transition: background 0.3s;
            }

            button:hover {
                background: hsl(200 80% 40%);
            }

            /* Бічна панель для теми */
            .side-panel {
                position: fixed;
                top: 50%;
                right: 0;
                transform: translateY(-50%);
                background: var(--card-bg);
                backdrop-filter: blur(15px) saturate(180%);
                border-radius: 12px 0 0 12px;
                padding: 10px;
                box-shadow: -2px 2px 12px rgba(0,0,0,0.3);
                display: flex;
                flex-direction: column;
                gap: 10px;
                transition: transform 0.3s;
            }

            .side-panel button {
                width: auto;
                padding: 6px 12px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body data-theme="light">

<div class="profile-card">
    <div id="myDiv" th:attr="data-id=${id}"></div>
    <input type="hidden" name="_method" value="post"/>

    <img th:src="'data:image/jpeg;base64,' + ${person.photo}" alt="Фото профілю" class="profile-photo"/>
    <label for="file">Оберіть фото:</label>
    <input type="file" name="file" id="file" accept="image/*" required>

    <div class="form-group">
        <label>Ім’я:</label>
        <input type="text" name="name" id="name" th:value="${person.name}" required/>
    </div>

    <div class="form-group">
        <label>Вік:</label>
        <input type="number" name="age" id="age" th:value="${person.age}" min="0" required/>
    </div>

    <div class="form-group">
        <label>Стать:</label>
        <select name="gender" id="gender">
            <option th:value="${person.gender}" th:text="${person.gender}" selected></option>
            <option th:value="'Male'" th:text="'Чоловік'" th:if="${person.gender != 'Male'}"></option>
            <option th:value="'Female'" th:text="'Жінка'" th:if="${person.gender != 'Female'}"></option>
            <option th:value="'Other'" th:text="'Інше'" th:if="${person.gender != 'Other'}"></option>
        </select>
    </div>

    <div class="form-group">
        <label>Абонемент:</label>
        <select id="seasonTicket">
            <option th:if="${person.seasonTicket != null}" th:value="${person.seasonTicket.id}"
                    th:text="${person.seasonTicket.ticketType}" selected></option>
            <option th:if="${person.seasonTicket == null}" value="" selected>Немає</option>
            <option th:each="ticket : ${seasonTickets}" th:value="${ticket.id}" th:text="${ticket.ticketType}"
                    th:if="${person.seasonTicket == null or ticket.id != person.seasonTicket.id}">
            </option>
        </select>
    </div>

    <div class="form-group">
        <label>Телеграм:</label>
        <input type="text" name="telegramAccount" id="telegramAccount" th:value="${person.telegramAccount}"/>
    </div>

    <div class="form-group">
        <label>Телефон:</label>
        <input type="text" name="phoneNumber" id="phoneNumber" th:value="${person.phoneNumber}"/>
    </div>

    <div class="form-group">
        <label>Gmail:</label>
        <input type="email" name="gmail" id="gmail" th:value="${person.gmail}"/>
    </div>

    <button onclick="updateProfile()">Оновити профіль</button>
</div>

<!-- Бічна панель для перемикання теми -->
<div class="side-panel">
    <button onclick="toggleTheme()">Змінити тему</button>
</div>

<script th:inline="javascript">
    function updateProfile() {
        let id = document.getElementById("myDiv").dataset.id;
        let name = document.getElementById("name").value;
        let gmail = document.getElementById("gmail").value;
        let telegramAccount = document.getElementById("telegramAccount").value;
        let phoneNumber = document.getElementById("phoneNumber").value;
        let gender = document.getElementById("gender").value;
        let age = document.getElementById("age").value;
        let seasonTicketId = document.getElementById("seasonTicket").value;
        let xmlhttp = new XMLHttpRequest();
        xmlhttp.open("POST", "/persons/profile");
        xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState === 4) {
                if (xmlhttp.status === 200) {
                    window.location.href = "/persons";
                } else {
                    alert("Помилка: " + xmlhttp.responseText);
                }
            }
        }

        xmlhttp.send(JSON.stringify({
            "id": id,
            "name": name,
            "gender": gender,
            "age": age,
            "telegramAccount": telegramAccount,
            "phoneNumber": phoneNumber,
            "gmail": gmail,
            "seasonTicketId": seasonTicketId
        }));
    }

    function toggleTheme() {
        const html = document.documentElement;
        html.dataset.theme = html.dataset.theme === 'light' ? 'dark' : 'light';
    }
</script>

</body>
</html>
