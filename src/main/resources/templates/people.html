<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–°–ø–∏—Å–æ–∫ —É—Å—ñ—Ö –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ–≤</title>

    <!-- –ù–æ–≤–∏–π —Å—Ç–∏–ª—å -->
    <link rel="stylesheet" href="https://unpkg.com/normalize.css">
    <style>
        /* —Ç–≤—ñ–π CSS –∑ @layer */
        @import url('https://unpkg.com/normalize.css') layer(normalize);

        @import url('https://unpkg.com/normalize.css') layer(normalize);

        @layer normalize, base, demo;

        @layer demo {
            :root {
                --accent: hsl(200 80% 50%);
                --border: color-mix(in oklch, canvas, canvasText 15%);
                --background: color-mix(in oklch, canvas, canvasText 2%);
                --head: light-dark(hsl(0 0% 98%), canvas);
                --selected: color-mix(in oklch, var(--accent), canvas 85%);
                --color: color-mix(in hsl, canvasText, #0000 50%);
                --hover-background: light-dark(hsl(0 0% 92%), hsl(0 0% 10%));
                --sibling-hover: red;
                --hover-color: green;
            }
            .members {
                background: light-dark(#fff, #000);
                overflow: auto;
                border: 1px solid var(--border);
                border-radius: 6px;
            }
            table {
                font-size: 0.875rem;
                border-collapse: collapse;
                background: #0000;
                color: var(--color);
            }
            input {
                color: var(--color);
            }
            table:focus-within tbody tr:not(:focus-within) {
                filter: blur(4px) saturate(0.2);
                pointer-events: none;
                opacity: 0.5;
            }
            tr:focus-within {
                background: var(--selected);
                td,
                input {
                    color: canvasText;
                }
            }
            thead {
                background: var(--head);
            }
            th,
            td:first-of-type {
                padding: 0.25rem 1rem;
            }
            :is(td, th) {
                height: 40px;
            }
            td {
                font-weight: 300;
            }
            tr {
                transition-property: filter, background, opacity;
                transition-duration: 0.2s;
                transition-timing-function: ease-out;

                &:not(:last-of-type) {
                    border-bottom: 1px solid var(--head);
                }
            }

            table :is(td, th) {
                white-space: nowrap;
                font-weight: 400;
                font-size: 0.875rem;
            }
            table th {
                text-align: left;
                font-weight: 500;
                color: color-mix(in hsl, canvasText, #0000 35%);
            }
            thead {
                background: var(--head);
            }

            td:not(:has(input)) {
                padding: 0.5rem 1rem;
            }

            tr:focus-within input:hover:not(:focus-visible) {
                background: color-mix(in oklch, var(--accent), #0000 75%);
            }

            table input {
                font-size: inherit;
                height: 40px;
                font-weight: inherit;
                border: 0;
                padding: 0.5rem 1rem;
                height: 100%;
                background: #0000;
                border-radius: 0;
                caret-color: var(--accent);
                transition: color 0.26s ease-out;

                &:hover:not(:focus-visible) {
                    background: var(--hover-background);
                }
                &::selection {
                    background: var(--accent);
                    color: white;
                }
                &:focus-visible {
                    background: light-dark(#fff, #000);
                    outline: 2px solid var(--accent);
                }
            }

            input:not(:focus, :focus-visible) {
                cursor: pointer;
            }
            table img {
                border-radius: 50%;
                width: 24px;
                aspect-ratio: 1;
            }
        }

        @layer base {
            :root {
                --font-size-min: 16;
                --font-size-max: 20;
                --font-ratio-min: 1.2;
                --font-ratio-max: 1.33;
                --font-width-min: 375;
                --font-width-max: 1500;
            }

            html {
                color-scheme: light dark;
            }

            [data-theme='light'] {
                color-scheme: light only;
            }

            [data-theme='dark'] {
                color-scheme: dark only;
            }

            :where(.fluid) {
                --fluid-min: calc(
                        var(--font-size-min) * pow(var(--font-ratio-min), var(--font-level, 0))
                );
                --fluid-max: calc(
                        var(--font-size-max) * pow(var(--font-ratio-max), var(--font-level, 0))
                );
                --fluid-preferred: calc(
                        (var(--fluid-max) - var(--fluid-min)) /
                        (var(--font-width-max) - var(--font-width-min))
                );
                --fluid-type: clamp(
                        (var(--fluid-min) / 16) * 1rem,
                        ((var(--fluid-min) / 16) * 1rem) -
                        (((var(--fluid-preferred) * var(--font-width-min)) / 16) * 1rem) +
                        (var(--fluid-preferred) * var(--variable-unit, 100vi)),
                        (var(--fluid-max) / 16) * 1rem
                );
                font-size: var(--fluid-type);
            }

            *,
            *:after,
            *:before {
                box-sizing: border-box;
            }

            body {
                background: light-dark(#fff, #000);
                display: grid;
                place-items: center;
                min-height: 100vh;
                font-family: 'SF Pro Text', 'SF Pro Icons', 'AOS Icons', 'Helvetica Neue',
                Helvetica, Arial, sans-serif, system-ui;
            }

            body::before {
                --size: 45px;
                --line: color-mix(in hsl, canvasText, transparent 80%);
                content: '';
                height: 100vh;
                width: 100vw;
                position: fixed;
                background: linear-gradient(
                        90deg,
                        var(--line) 1px,
                        transparent 1px var(--size)
                )
                calc(var(--size) * 0.36) 50% / var(--size) var(--size),
                linear-gradient(var(--line) 1px, transparent 1px var(--size)) 0%
                calc(var(--size) * 0.32) / var(--size) var(--size);
                mask: linear-gradient(-20deg, transparent 50%, white);
                top: 0;
                transform-style: flat;
                pointer-events: none;
                z-index: -1;
            }

            .bear-link {
                color: canvasText;
                position: fixed;
                top: 1rem;
                left: 1rem;
                width: 48px;
                aspect-ratio: 1;
                display: grid;
                place-items: center;
                opacity: 0.8;
            }

            :where(.x-link, .bear-link):is(:hover, :focus-visible) {
                opacity: 1;
            }

            .bear-link svg {
                width: 75%;
            }

            /* Utilities */
            .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border-width: 0;
            }
        }

        h1 {
            margin: 0;
            font-size: 1.25rem;
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            font-family: monospace;
            opacity: .5;
        }
        .telegram-link {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            font-family: monospace;
            font-size: 1.1rem;
            color: color-mix(in hsl, canvasText, #0000 25%);
            text-decoration: none;
            opacity: 0.7;
            transition: all 0.3s ease;
        }

        .telegram-link:hover {
            opacity: 1;
            color: var(--accent);
            text-decoration: underline;
        }
        .sort-icon.asc {
            transform: rotate(180deg);
        }
        .sort-icon.desc {
            transform: rotate(0deg);
        }

        .pagination {
            margin-top: 20px;
        }

        .pagination a {
            padding: 6px 10px;
            margin: 2px;
            text-decoration: none;
            border: 1px solid #ccc;
            color: black;
        }

        .pagination a.active {
            background: black;
            color: white;
        }

        th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        th.sortable a {
            color: inherit;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        th.sortable:hover {
            background: var(--hover-background);
        }

        .sort-icon {
            font-size: 0.7rem;
            opacity: 0.6;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }

        th.sortable:hover .sort-icon {
            opacity: 1;
        }

        /* ... –≤—Å—Ç–∞–≤–ª—è—î—à —É–≤–µ—Å—å –∫–æ–¥ —â–æ —Ç–∏ –∫–∏–Ω—É–≤ ... */
    </style>


</head>
<body>

<h1>–°–ø–∏—Å–æ–∫ —É—Å—ñ—Ö –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á—ñ–≤ —Å–ø–æ—Ä—Ç–∑–∞–ª—É</h1>

<div class="members">
    <table>
        <thead>
        <tr>
            <th></th>
            <th>Id</th>
            <th class="sortable" onclick="sortTableByName()">
                –Ü–º'—è <span class="sort-icon" id="nameSortIcon">‚Üï</span>
            </th>
            <th>–í—ñ–∫</th>
            <th>–°—Ç–∞—Ç—å</th>
            <th>–ê–±–æ–Ω–µ–º–µ–Ω—Ç</th>
            <th>–¢–µ–ª–µ–≥—Ä–∞–º</th>
            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <th>Email</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="person : ${people}">
            <td><img th:src="'data:image/jpeg;base64,' + ${person.photo}"></td>
            <td th:text="${person.id}">ID</td>
            <td>
                <a th:href="@{'/people/profile/' + ${person.id}}"
                   th:text="${person.name}" target="_blank">–Ü–º‚Äô—è</a>
            </td>
            <td th:text="${person.age}">–í—ñ–∫</td>
            <td th:text="${person.gender}">–°—Ç–∞—Ç—å</td>
            <td th:text="${person.seasonTicket != null ? person.seasonTicket.ticketType : '---'}">–ö–≤–∏—Ç–æ–∫</td>
            <td>
                <a th:href="@{'https://t.me/' + ${person.telegramAccount}}"
                   th:text="${person.telegramAccount != null && !person.telegramAccount.isEmpty() ? person.telegramAccount : '‚Äî'}"
                   target="_blank">–¢–µ–ª–µ–≥—Ä–∞–º</a>
            </td>
            <td th:text="${person.phoneNumber != null && !person.phoneNumber.isEmpty() ? person.phoneNumber : '‚Äî'}">–¢–µ–ª–µ—Ñ–æ–Ω</td>
            <td>
                <a th:text="${person.email != null && !person.email.isEmpty() ? person.email : '‚Äî'}"
                   th:href="@{'/people/sendEmail'(id=${person.id})}" target="_blank">Email</a>
            </td>
            <td>
                <button type="button"
                        style="background-color: #dc3545; color: white; padding: 6px 12px; border-radius: 6px; border: none; cursor: pointer;"
                        th:onclick="'deletePerson(' + ${person.id} + ', this)'">
                    –í–∏–¥–∞–ª–∏—Ç–∏
                </button>
            </td>
        </tr>
        </tbody>
    </table>
    <div class="pagination">
        <a th:if="${page.hasPrevious()}"
           th:href="@{/people(page=${page.number - 1}, sortField=${sortField}, direction=${direction})}">‚Üê</a>

        <span th:each="i : ${#numbers.sequence(
        T(java.lang.Math).max(0, page.number - 2),
        T(java.lang.Math).min(page.totalPages - 1, page.number + 2)
    )}">
        <a th:href="@{/people(page=${i}, sortField=${sortField}, direction=${direction})}"
           th:text="${i + 1}"
           th:classappend="${i == page.number} ? 'active' : ''"></a>
    </span>

        <a th:if="${page.hasNext()}"
           th:href="@{/people(page=${page.number + 1}, sortField=${sortField}, direction=${direction})}">‚Üí</a>
    </div>

</div>

<div class="actions">
    <a href="/people/add">‚ûï –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—É –æ—Å–æ–±—É</a>
    <a href="/people/users/export/excel" target="_blank">üìä –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Excel</a>
</div>

<script th:inline="javascript">
    function deletePerson(id, btnElement) {
        if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—å–æ–≥–æ –≤—ñ–¥–≤—ñ–¥—É–≤–∞—á–∞?')) return;
        fetch('/people/delete?personId=' + id, { method: 'DELETE' })
            .then(response => {
                if (response.ok) {
                    let row = btnElement.closest('tr');
                    row.remove();
                } else {
                    alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤–∏–¥–∞–ª–∏—Ç–∏. –ö–æ–¥: ' + response.status);
                }
            }).catch(error => {
            console.error('–ü–æ–º–∏–ª–∫–∞:', error);
            alert('–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—ñ');
        });
    }
</script>

<!-- –ü–∞–Ω–µ–ª—å –∫–æ–Ω—Ñ—ñ–≥–∞ (—è–∫—â–æ —Ö–æ—á–µ—à) -->
<script type="module">
    import { Pane } from 'https://cdn.skypack.dev/tweakpane@4.0.4'
    const config = { theme: 'system', color: 'hsl(200,80%,50%)' }
    const ctrl = new Pane({ title: 'Config', expanded: true })
    const update = () => {
        document.documentElement.dataset.theme = config.theme
        document.documentElement.style.setProperty('--accent', config.color)
    }
    const sync = (event) => {
        if (!document.startViewTransition ||
            event.target.controller.view.labelElement.innerText !== 'Theme')
            return update()
        document.startViewTransition(() => update())
    }
    ctrl.addBinding(config, 'color', { label: 'accent' })
    ctrl.addBinding(config, 'theme', {
        label: 'Theme',
        options: { System: 'system', Light: 'light', Dark: 'dark' }
    })
    ctrl.on('change', sync)
    update()
</script>

<script>
    let nameAsc = true;

    function sortTableByName(){
        const table = document.querySelector(".members table tbody");
        const rows = Array.from(table.querySelectorAll("tr"));

        rows.sort((a, b) => {
            const nameA = a.querySelector("td:nth-child(3)").innerText.toLowerCase();
            const nameB = b.querySelector("td:nth-child(3)").innerText.toLowerCase();
            if(nameA < nameB) return nameAsc ? -1 : 1;
            if(nameA > nameB) return nameAsc ? 1 : -1;
            return 0;
        });

        rows.forEach(row => table.appendChild(row));

        nameAsc = !nameAsc;

        document.getElementById("nameSortIcon").innerText = nameAsc ? '‚Üë' : '‚Üì';

    }
</script>

<a href="https://t.me/gymbotakte0nbot" target="_blank" class="telegram-link">
    ü§ñ –ù–∞—à Telegram-–±–æ—Ç
</a>

</body>
</html>
